# ParaOpt

A python optimizer for developing molecular simulation forcefield 

Author: MP, WD

## Installation

## Usage

An input text file is needed to configure all stuffs related to the optimizing 
process. You also need your own post-processing script to extract the values of
the properties you choosed as the optimization target.

### Configurations

The input configuration file is organized in the standard .INI file format. 
All options are grouped in four sections: simulation, properties, parameters, 
and optimization. See [config.sample] as a example to create your config file.

#### [ simulation ]

lmp: the LAMMPS executable called to run your simulation.
path: the path under which you run your simulation, relative to the current 
executing directory.
inFileName: your lammps input file.
processScript: your post-process script to obtain targeted property values.

Note: the value of "inFileName" and "processScript" indicate a relative path to
the "path" value. E.g., "inFileName = in.lammps" points to the input file under 
the simulation folder, and "processScript = ../process.sh" points to a script 
file in the parent directory.

#### [ optimization ]

optMethod: the optimization algorithm, which could be one of the following:
 - "Nelder-Mead"

#### [ properties ]

totalProperties: the number of targeted properties, which should match the
output by your post-processing script.
propertyNName: the name of the Nth property, which could be left blank and will
be aotumatically assigned as "q_N".
propertyNRef: the reference value for the Nth property.
propertyNSpecial: (optional) the special handling for the target-function of 
the Nth property, the value of which could be one of the following:
 - "log": calcualte the target-function for the logarithmized value;
 - "scaled": calculate the scaled target-function.
propertyNSpecialArg: (optional) the argument for the special handling, which 
could be a number when "propertyNSpecial = scaled", indicating the scaling 
coefficient.

Note: If "totalProperties = M", in total M bunches of "propertyN*" options
should be given, where N = 1, 2, ..., M

#### [ parameters ]

initParaTableFile: a tabulated file listing the initial parameter values, in 
which only two lines are contained like the example below; the 1st line
starts with "#" and lists the parameter names (or tags, symbols), and the 2nd
line lists the corresponding values.
```bash
# epsilon_1 sigma_1 epsilon_2 sigma_2 epsilon_3 sigma_3
0.1 10 0.2 20 0.3 30
```
paraTableFile: a tabulated file that the parameter values generated by every 
optimizing interation will be written into; it will contain the same columns as
"initParaTableFile" and N+2 rows after N interation steps.
ffTemplate: the forcefield template file prepared for the simulation; the 
parameter names (1st line in "paraTableFile")are contained in the correct 
place in this template file; before each iteration, the parameter values 
optimized from the last interation are filled in the correct locations 
accordingly, to generate a forcefield file ("ffForSimulation") read by the 
simulation; still taking the example "initParaTableFile" above, and assuming 
you have a template forcefield file like this:
```bash
pair_coeff    1    1	  @epsilon_1 @sigma_1
pair_coeff    1    2	  @epsilon_2 @sigma_2 
pair_coeff    1    3	  @epsilon_3 @sigma_3 
```
a real forcefield file for the simulation in the 1st step will be:
```bash
pair_coeff    1    1	  0.1 10 
pair_coeff    1    2	  0.2 20 
pair_coeff    1    3	  0.3 30 
```
ffForSimulation: See above.

Note: all files identified in this section imply a path relative to the 
executing directory.

### Post-processing script

You can use whatever script you like to post-process your data. The only 
requirement is that the final numbers of all target property should be saved in
one line, separated by blank space, in a file named "res.postprocess" under 
your simulation path.

For example, it can be a shell script like:
```bash

q1=$(SOME_COMMANDS_TO_OBTAIN_PROPERTY1)
q2=$(SOME_COMMANDS_TO_OBTAIN_PROPERTY2)
q3=$(SOME_COMMANDS_TO_OBTAIN_PROPERTY3)
q4=$(SOME_COMMANDS_TO_OBTAIN_PROPERTY4)

echo ${q1} ${q2} ${q3} ${q4} > res.postprocess
```

[config.sample]: https://github.com/wdingsjtu/ParaOpt/blob/master/config.sample
